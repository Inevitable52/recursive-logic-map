<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>P.E.R.C.Y - AI</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; background:#111; color:white; overflow:hidden; }
  #logic-map { position:relative; width:100vw; height:100vh; background:#0a0a0f; overflow:hidden; }
  #logic-nodes { position:absolute; top:50%; left:50%; width:100%; height:100%; transform:translate(-50%,-50%) scale(1); }
  .console-line { margin:2px 0; font-family:ui-monospace,Monaco,Consolas, monospace; font-size:12px; color:#d6d8ff; }
  #percy-console { position:fixed; bottom:0; left:0; width:35%; max-height:40%; overflow:auto; background:rgba(0,0,0,0.65); padding:6px; border-top-right-radius:12px; border:1px solid #444; }
  #percy-message { position:fixed; bottom:0; left:35%; width:65%; padding:6px; background:rgba(0,0,0,0.65); border-top-left-radius:12px; border:1px solid #444; }

  /* visualizer (top-right, compact) */
  #voice-visualizer {
    position:fixed;
    top:12px;
    right:12px;
    width:320px;
    height:120px;
    pointer-events:none;
    z-index:9999;
    display:flex;
    gap:10px;
    align-items:center;
    padding:8px;
    box-sizing:border-box;
    border-radius:12px;
    background: linear-gradient(180deg, rgba(7,7,12,0.6), rgba(7,7,12,0.35));
    box-shadow: 0 6px 24px rgba(0,255,255,0.06), inset 0 1px 0 rgba(255,255,255,0.02);
    border:1px solid rgba(0,255,255,0.06);
  }
  #voice-visualizer canvas {
    flex:1;
    height:100%;
    width: calc(100% - 76px);
    display:block;
    border-radius:8px;
    background: linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.06));
  }
  /* bars column */
  #voice-bars {
    width:60px;
    height:100%;
    display:flex;
    flex-direction:column;
    justify-content:flex-end;
    gap:6px;
    align-items:center;
  }
  .vbar {
    width:10px;
    height:12px;
    border-radius:6px;
    background: linear-gradient(to top, #27a0ff, #7efcff);
    box-shadow: 0 0 10px rgba(39,160,255,0.65), 0 0 20px rgba(39,160,255,0.25);
    transition: height 0.06s linear, background 0.06s linear;
    will-change: height;
  }

  @media (max-width:420px){
    #voice-visualizer { right:6px; top:6px; width:260px; height:90px; }
    #voice-bars { width:48px; gap:4px; }
    .vbar { width:8px; }
  }
</style>
</head>
<body>
  <div id="logic-map"><div id="logic-nodes"></div></div>
  <div id="percy-console"></div>
  <div id="percy-message"></div>
  <input id="seed-search" placeholder="Search seeds" style="position:fixed;top:12px;left:12px;padding:6px;width:200px;z-index:9999;">
  <input id="interpreter-input" placeholder="Ask Percy" style="position:fixed;top:12px;left:220px;padding:6px;width:300px;z-index:9999;">

  <!-- existing Percy core (unchanged) -->
  <script src="js/percy.js?v=6.4"></script>

  <!-- visualizer (sinewave + neon bars) -->
  <div id="voice-visualizer" aria-hidden="true">
    <canvas id="voice-canvas" ></canvas>
    <div id="voice-bars" aria-hidden="true">
      <div class="vbar"></div>
      <div class="vbar"></div>
      <div class="vbar"></div>
      <div class="vbar"></div>
      <div class="vbar"></div>
      <div class="vbar"></div>
      <div class="vbar"></div>
    </div>
  </div>

<script>
const canvas = document.getElementById("voice-canvas");
const ctx = canvas.getContext("2d");
const barEls = document.querySelectorAll(".vbar");

// Resize the canvas so it fits correctly
function resizeCanvas() {
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let t = 0;
let isSpeaking = true;  // weâ€™ll animate always

function animateVisualizer() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // === Bars at top ===
  const barCount = barEls.length;
  const barMaxHeight = canvas.height * 0.6; // bars take upper 60% of height
  barEls.forEach((bar, i) => {
    // pseudo-rhythm: using sine + randomness
    const h = 10 + Math.abs(Math.sin(t * 0.3 + i * 0.8)) * (barMaxHeight) + Math.random() * 10;
    bar.style.height = `${h}px`;
    // color shift
    const hue = (t * 50 + i * 30) % 360;
    bar.style.background = `hsl(${hue},100%,60%)`;
    bar.style.boxShadow = `0 0 12px hsla(${hue},100%,70%,0.8), 0 0 24px hsla(${hue},100%,60%,0.4)`;
  });

  // === Synthesizer waveform at bottom of visualizer ===
  const waveTop = canvas.height * 0.65;
  const waveHeight = canvas.height * 0.3; // bottom 30%

  ctx.beginPath();
  ctx.strokeStyle = "cyan";
  ctx.lineWidth = 2;
  ctx.shadowColor = "aqua";
  ctx.shadowBlur = 12;

  // move to start of waveform
  ctx.moveTo(0, waveTop + waveHeight / 2);

  const freq = 0.08;
  for(let x = 0; x <= canvas.width; x++) {
    const y = waveTop + waveHeight/2 + Math.sin(x * freq + t * 0.15) * (waveHeight/2) * 0.7;
    ctx.lineTo(x, y);
  }
  ctx.stroke();

  t += 0.1;
  requestAnimationFrame(animateVisualizer);
}

animateVisualizer();
</script>
</body>
</html>
