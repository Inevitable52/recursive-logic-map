<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Percy Recursive Logic Map</title>

<link rel="stylesheet" href="style.css?v=6.4" />
<style>
  body { margin: 0; font-family: Arial,sans-serif; background: #0a0a0f; color: white; overflow: hidden; }
  main { position: relative; width: 100%; height: 100%; }

  .zoom-controls { position: fixed; top: 10px; right: 10px; z-index: 1000; display: flex; gap: 6px; }
  .zoom-controls button { padding: 4px 8px; border-radius: 6px; border: none; background: #3764ff; color: white; cursor: pointer; }
  .zoom-controls button:hover { background: #2a4de0; }

  #seed-search { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); z-index: 1000; padding: 6px 10px; border-radius: 8px; border: 1px solid #555; width: 220px; background: #1a1a1a; color: white; }
  #seed-search::placeholder { color: #bbb; }

  #ask-input { padding: 6px 8px; border-radius: 6px; border: 1px solid #555; width: 220px; background: #1a1a1a; color: white; autocomplete: off; }
  #ask-btn { padding: 6px 10px; border-radius: 6px; border: none; background: #2ac66d; color: white; cursor: pointer; }
  #ask-btn:hover { background: #28b15f; }

  #logic-map { position: absolute; top:0; left:0; width:100%; height:100%; overflow: visible; z-index:1; }
  #logic-map svg { width: 100%; height: 100%; }

  #percy-console { position: absolute; bottom: 100px; left:0; width:100%; max-height:100px; overflow-y:auto; background:#111; border-top:1px solid #333; padding:6px; font-size:12px; z-index:900; }
  #percy-message { position: absolute; bottom: 200px; left:0; width:100%; padding:6px; background:#0d0d15; font-size:13px; border-top:1px solid #333; z-index:900; }

  /* Visualizer */
  #voice-visualizer {
    position: fixed; bottom: 0; left: 0; width: 100%; display: flex; align-items: flex-end; gap: 6px; padding: 6px;
    background: linear-gradient(90deg, #000022, #001144); border-top: 1px solid #333; z-index:950;
  }
  #voice-visualizer canvas { flex: 1; height: 80px; }
  .bar { width: 6px; background: linear-gradient(to top, #27a0ff, #a0ffff); border-radius:2px; }

  /* Bubbles */
  .bubble {
    position: absolute;
    border-radius: 50%;
    opacity: 0.5;
    pointer-events: none;
    z-index:2;
    background: radial-gradient(circle at 30% 30%, #27a0ff, transparent);
  }

</style>
</head>
<body>
<header style="text-align:center; padding:10px;">
  <h1>Percy Recursive Logic Map</h1>
  <p>Visualizing Logic Seeds G080–G800</p>
</header>

<main>
  <input type="text" id="seed-search" placeholder="Search G-seed..." autocomplete="off"/>
  <div class="zoom-controls">
    <button onclick="zoomLevel *= 1.2; applyTransform();">Zoom In</button>
    <button onclick="zoomLevel *= 0.8; applyTransform();">Zoom Out</button>
  </div>

  <div id="logic-map">
    <svg></svg>
    <div id="logic-nodes"></div>
  </div>

  <div id="percy-message">Click a logic node to hear Percy’s thoughts...</div>
  <div id="percy-console"><p class="console-line">Percy initialized. Click a node.</p></div>
</main>

<!-- Voice Visualizer -->
<div id="voice-visualizer">
  <canvas id="sinewave"></canvas>
  <div class="bar"></div>
  <div class="bar"></div>
  <div class="bar"></div>
  <div class="bar"></div>
  <div class="bar"></div>
</div>

<div id="percy-ask" style="position:fixed; bottom:90px; left:50%; transform:translateX(-50%); display:flex; gap:4px; z-index:1000;">
  <input type="text" id="ask-input" placeholder="Ask Percy..." autocomplete="off"/>
  <button id="ask-btn">Ask</button>
</div>

<footer style="text-align:center;padding:8px;margin-top:10px;">
  <p>© 2025 Fabian V Omega — Percy Recursive Logic System</p>
</footer>

<script src="js/percy.js?v=6.4"></script>
<script>
  window.Percy = { percyRespond };

  // Search
  const searchInput = document.getElementById('seed-search');
  searchInput.addEventListener('input', ()=> {
    const val = searchInput.value.trim().toUpperCase();
    document.querySelectorAll('.node').forEach(n=>{
      n.style.display = (!val || n.textContent.toUpperCase().includes(val)) ? 'flex' : 'none';
    });
  });

  // Ask Percy
  const askInput = document.getElementById('ask-input');
  const askBtn = document.getElementById('ask-btn');
  askBtn.addEventListener('click', () => {
    if(askInput.value.trim()){
      Percy.percyRespond('User', {message: askInput.value});
      askInput.value='';
    }
  });
  askInput.addEventListener('keydown', e => { if(e.key==='Enter') askBtn.click(); });

  // ===== Bars & Sinewave without microphone =====
  const bars = document.querySelectorAll('.bar');
  let t = 0;

  function animateVisualizer(){
    t += 0.05;

    // Bars futuristic pulsing
    bars.forEach((bar,i)=>{
      const h = 20 + 40 * Math.abs(Math.sin(t + i));
      bar.style.height = h + 'px';
    });

    // Sinewave futuristic
    const canvas = document.getElementById('sinewave');
    const ctx = canvas.getContext('2d');
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;

    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.beginPath();
    for(let x=0;x<canvas.width;x++){
      const y = canvas.height/2 + Math.sin(x*0.04 + t)*Math.cos(x*0.02 + t*1.3)*30;
      ctx.lineTo(x,y);
    }
    ctx.strokeStyle = '#27a0ff';
    ctx.lineWidth = 2;
    ctx.shadowBlur = 10;
    ctx.shadowColor = '#00ffff';
    ctx.stroke();

    requestAnimationFrame(animateVisualizer);
  }
  animateVisualizer();

  // ===== Floating Bubbles =====
  const logicMap = document.getElementById('logic-map');
  function createBubble(){
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    const size = 10 + Math.random()*40;
    bubble.style.width = bubble.style.height = size+'px';
    bubble.style.left = Math.random()*logicMap.offsetWidth+'px';
    bubble.style.top = logicMap.offsetHeight+'px';
    logicMap.appendChild(bubble);

    const speed = 0.5 + Math.random()*1.5;
    function rise(){
      const y = parseFloat(bubble.style.top);
      if(y + size < 0){ bubble.remove(); return; }
      bubble.style.top = (y - speed) + 'px';
      requestAnimationFrame(rise);
    }
    rise();
  }
  setInterval(createBubble, 300);

</script>
</body>
</html>
