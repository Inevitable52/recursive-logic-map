<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Percy TrueAI</title>
<style>
body {
    margin:0;
    font-family:Arial,sans-serif;
    background:#111;
    color:white;
    overflow:hidden;
}
/* Logic Map & Nodes */
#logic-map { background:#0a0a0f; position:relative; width:100vw; height:100vh; overflow:hidden; }
#logic-nodes { position:absolute; top:50%; left:50%; width:100%; height:100%; transform:translate(-50%,-50%) scale(1); }
.node {
    position:absolute;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:#fff;
    cursor:pointer;
    background: radial-gradient(100% 100% at 30% 30%, rgba(255,255,255,0.10), rgba(0,0,0,0.10));
    border:2px solid currentColor;
    box-shadow:0 0 6px currentColor, 0 0 14px currentColor, inset 0 0 12px rgba(255,255,255,0.08);
    text-shadow:0 1px 2px rgba(0,0,0,0.6);
    user-select:none;
    transition:transform .15s ease, box-shadow .15s ease, filter .15s ease;
    backdrop-filter: blur(1px);
}
.node:hover { transform: scale(1.08); filter: brightness(1.15); }
.node:active { transform: scale(0.98); }
.cyan-bubble{color:#00eaff;} .blue-bubble{color:#27a0ff;} .magenta-bubble{color:#ff4af0;}
.red-bubble{color:#ff3b3b;} .orange-bubble{color:#ff9d2e;} .yellow-bubble{color:#ffe44a;} .green-bubble{color:#4caf50;}
.console-line{margin:2px 0;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;font-size:12px;color:#d6d8ff;}
#percy-voice-canvas {
    position:absolute;
    bottom:0; left:0;
    width:100%;
    height:120px;
    pointer-events:none;
    z-index:1000;
    background:linear-gradient(0deg, rgba(0,0,0,0.2), transparent);
}
</style>
</head>
<body>
<div id="logic-map">
    <div id="logic-nodes"></div>
    <canvas id="percy-voice-canvas"></canvas>
    <div id="percy-console" style="position:absolute;bottom:0;left:0;width:100%;max-height:200px;overflow-y:auto;background:rgba(0,0,0,0.4);padding:8px;"></div>
    <div id="percy-message" style="position:absolute;top:0;left:0;width:100%;padding:4px;font-size:14px;"></div>
</div>
<input id="seed-search" placeholder="Search seeds..." style="position:absolute;top:36px;left:10px;width:200px;padding:4px;">
<input id="interpreter-input" placeholder="Ask Percy..." style="position:absolute;top:60px;left:10px;width:200px;padding:4px;">

<script>
document.addEventListener('DOMContentLoaded', () => {
    // === VOICE VISUALIZER ===
    const canvas = document.getElementById('percy-voice-canvas');
    const ctx = canvas.getContext('2d');
    let audioCtx, analyser, dataArray, source;
    
    function initVoiceVisualizer() {
        if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return;
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 512;
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
            source = audioCtx.createMediaStreamSource(stream);
            source.connect(analyser);
            drawVoiceVisualizer();
        }).catch(()=>console.warn("Voice visualization unavailable."));
    }

    function drawVoiceVisualizer() {
        if(!analyser) return;
        const width = canvas.width = window.innerWidth;
        const height = canvas.height = 120;
        requestAnimationFrame(drawVoiceVisualizer);
        analyser.getByteTimeDomainData(dataArray);
        ctx.fillStyle = "rgba(0,0,0,0.2)";
        ctx.fillRect(0, 0, width, height);

        ctx.lineWidth = 2;
        ctx.strokeStyle = '#00eaff';
        ctx.beginPath();
        const sliceWidth = width / dataArray.length;
        let x = 0;
        for(let i=0;i<dataArray.length;i++){
            const v = dataArray[i]/128.0;
            const y = v * height/2;
            if(i===0) ctx.moveTo(x,y);
            else ctx.lineTo(x,y);
            x += sliceWidth;
        }
        ctx.lineTo(width, height/2);
        ctx.stroke();

        // Neon bars
        const barWidth = width / 64;
        for(let i=0;i<64;i++){
            const barHeight = dataArray[i*8]/2;
            ctx.fillStyle = `rgba(0,255,255,0.5)`;
            ctx.fillRect(i*barWidth, height-barHeight, barWidth-2, barHeight);
        }
    }

    initVoiceVisualizer();

    // === PERCY STATE & NODES ===
    const PercyState={gnodes:{}, getNextId(){let next=801; while(this.gnodes[`G${String(next).padStart(3,'0')}`]) next++; return `G${String(next).padStart(3,'0')}`; }};
    const seeds = {};
    const logicMap=document.getElementById('logic-map');
    const logicNodes=document.getElementById('logic-nodes');
    function createNodes(){
        logicNodes.innerHTML='';
        const width=logicMap.clientWidth, height=logicMap.clientHeight;
        layoutRing(80,200,width,height,width/2.5,'cyan-bubble',60);
        layoutRing(201,300,width,height,width/3.4,'blue-bubble',45);
        layoutRing(301,400,width,height,width/4.8,'magenta-bubble',30);
        layoutRing(401,500,width,height,width/6.6,'red-bubble',22);
        layoutRing(501,600,width,height,width/8.5,'orange-bubble',18);
        layoutRing(601,700,width,height,width/11,'yellow-bubble',14);
        layoutRing(701,800,width,height,width/14,'green-bubble',12);
    }
    function layoutRing(startId,endId,width,height,radius,colorClass,nodeSize){
        const ringSeeds = Object.entries(seeds).filter(([id])=>{
            const num=parseInt(id.replace("G",""));
            return num>=startId && num<=endId;
        });
        const total = Math.max(1, ringSeeds.length);
        const cx=width/2, cy=height/2;
        ringSeeds.forEach(([id,data],i)=>{
            const angle = (i/total)*2*Math.PI;
            const x = cx+radius*Math.cos(angle)-nodeSize/2;
            const y = cy+radius*Math.sin(angle)-nodeSize/2;
            const node = document.createElement('div');
            node.classList.add('node',colorClass);
            node.style.width=node.style.height=`${nodeSize}px`;
            node.style.left=`${x}px`; node.style.top=`${y}px`;
            node.textContent=id;
            node.title=data?.message||id;
            logicNodes.appendChild(node);
        });
    }
    createNodes();
});
</script>
</body>
</html>
