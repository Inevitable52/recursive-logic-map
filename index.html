<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Percy ASI System</title>

  <!-- ‚úÖ Percy Core -->
  <script src="js/percy.js?v=6.4"></script>

  <!-- ‚úÖ Percy ASI loader (auto-init) -->
  <script>
    (function loadASI() {
      function initASI() {
        if (window.Percy && window.Percy.ASI) {
          Percy.ASI.init({
            eventHooks: {
              taskComplete: [t => console.log('üß© ASI task complete:', t)]
            }
          });
          console.log('‚úÖ Percy.ASI initialized');
        }
      }

      if (!window.Percy || !Percy.ASI) {
        const script = document.createElement('script');
        script.src = 'js/percy-asi.js?v=1.0';
        script.onload = initASI;
        document.head.appendChild(script);
        console.log('‚è≥ Loading Percy.ASI dynamically...');
      } else {
        initASI();
      }
    })();
  </script>

  <!-- ‚úÖ TensorFlow models for face/object detection -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2"></script>
</head>

<body>
  <h2>Percy ASI System Active</h2>

  <!-- Video + overlay -->
  <video id="camera-feed" autoplay muted playsinline style="width:480px; height:auto;"></video>
  <canvas id="camera-overlay" style="position:absolute; top:0; left:0;"></canvas>

  <!-- Audio visualizer -->
  <canvas id="voice-canvas" width="480" height="120" style="display:block; margin-top:12px;"></canvas>

  <script>
    // Initialize Percy.ASI vision once DOM is ready
    window.addEventListener('load', async () => {
      try {
        if (Percy?.ASI?.parts?.PartZ && Percy.ASI.parts.PartZ.init) {
          await Percy.ASI.parts.PartZ.init('camera-feed', 'camera-overlay', 'voice-canvas');
          console.log('üé• Percy.ASI PartZ initialized (camera + audio)');
        } else {
          console.warn('‚ö†Ô∏è Percy.ASI PartZ not found ‚Äî ensure it‚Äôs defined in percy.js or percy-asi.js');
        }
      } catch (err) {
        console.error('ASI vision init failed:', err);
      }
    });
  </script>
</body>
</html>
