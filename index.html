<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>P.E.R.C.Y - Humanized AI Face + 3D Head</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root {
    --bg: #0a0a0f;
    --neon-a: #00ffff;
    --neon-b: #ff00ff;
    --accent: #1aff55;
    --head-size: 420px;
  }

  html, body {
    height: 100%;
    margin: 0;
    background: var(--bg);
    font-family: Consolas, monospace;
    overflow: hidden;
    color: #e8eefc;
  }

  #logic-map {
    position: relative;
    width: 100vw;
    height: 100vh;
    background: #090912;
    overflow: hidden;
  }

  /* === Humanized AI HEAD === */
  #percy-head-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: var(--head-size);
    height: calc(var(--head-size) * 1.2);
    pointer-events: none;
    z-index: 1000;
    filter: drop-shadow(0 0 25px rgba(255,0,255,0.4))
            drop-shadow(0 0 50px rgba(0,255,255,0.3));
  }

  #percy-head {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 50% / 55%;
    background: radial-gradient(circle at 50% 40%, #22222b, #08080f);
    border: 2px solid rgba(255,255,255,0.05);
    box-shadow: 0 0 30px rgba(0,255,255,0.2), inset 0 0 20px rgba(255,0,255,0.05);
    overflow: hidden;
  }

  /* Canvas behind the CSS features */
  #percy-head-canvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    border-radius: 50% / 55%;
    z-index: 0;
  }

  .head-layer.inner {
    position: absolute;
    inset: 0;
    border-radius: 50% / 55%;
    background: radial-gradient(circle at 50% 45%, rgba(255,255,255,0.05), transparent 70%);
    mix-blend-mode: screen;
    z-index: 1;
  }

  #percy-eyes {
    position: absolute;
    top: 35%;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    display: flex;
    justify-content: space-between;
    z-index: 2;
  }

  .eye {
    position: relative;
    width: 20%;
    padding-bottom: 20%;
    border-radius: 50%;
    background: radial-gradient(circle at 50% 50%, #fff 35%, #222 100%);
    box-shadow: 0 0 20px rgba(0,255,255,0.5);
    overflow: hidden;
  }

  .pupil {
    position: absolute;
    top: 35%;
    left: 35%;
    width: 30%;
    height: 30%;
    background: #000;
    border-radius: 50%;
    box-shadow: 0 0 6px rgba(0,0,0,0.6);
  }

  .eyelid {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg);
    border-radius: 50%;
    transform: scaleY(0);
    transform-origin: top;
    animation: blink 5s infinite;
  }

  @keyframes blink {
    0%, 92%, 100% { transform: scaleY(0); }
    95% { transform: scaleY(1); }
  }

  #percy-mouth {
    position: absolute;
    bottom: 18%;
    left: 50%;
    width: 40%;
    height: 8%;
    transform: translateX(-50%);
    background: radial-gradient(circle at 50% 50%, #ff6fbf, #ff0077);
    border-radius: 50% / 50%;
    box-shadow: 0 0 12px rgba(255,0,255,0.6);
    transition: height 0.1s ease-in-out;
    z-index: 2;
  }

  /* Console + UI omitted for brevity; keep your existing styles */
</style>
</head>
<body>

<div id="logic-map"><div id="logic-nodes"></div></div>

<!-- Humanized AI HEAD -->
<div id="percy-head-container">
  <canvas id="percy-head-canvas"></canvas> <!-- Three.js canvas -->
  <div id="percy-head">
    <div class="head-layer inner"></div>
    <div id="percy-eyes">
      <div class="eye">
        <div class="pupil"></div>
        <div class="eyelid"></div>
      </div>
      <div class="eye">
        <div class="pupil"></div>
        <div class="eyelid"></div>
      </div>
    </div>
    <div id="percy-mouth"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>

<script>
  // === 3D Head ===
  const canvas = document.getElementById("percy-head-canvas");
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0a0a0f);

  const camera = new THREE.PerspectiveCamera(45, canvas.clientWidth/canvas.clientHeight, 0.1, 1000);
  camera.position.z = 3;

  const renderer = new THREE.WebGLRenderer({ canvas, alpha:true, antialias:true });
  renderer.setSize(canvas.clientWidth, canvas.clientHeight);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  const ambient = new THREE.AmbientLight(0xffffff, 0.5);
  scene.add(ambient);
  const pointLight = new THREE.PointLight(0xff00ff, 1);
  pointLight.position.set(2,2,2);
  scene.add(pointLight);

  const geom = new THREE.BufferGeometry();
  const radius = 1;
  const points = [];
  for(let i=0;i<2000;i++){
    const phi = Math.random()*Math.PI;
    const theta = Math.random()*2*Math.PI;
    const r = radius + Math.random()*0.02;
    points.push(
      r*Math.sin(phi)*Math.cos(theta),
      r*Math.cos(phi),
      r*Math.sin(phi)*Math.sin(theta)
    );
  }
  geom.setAttribute('position', new THREE.Float32BufferAttribute(points,3));

  const material = new THREE.PointsMaterial({ color: 0x00ffff, size:0.02 });
  const headPoints = new THREE.Points(geom, material);
  scene.add(headPoints);

  const wireMesh = new THREE.Mesh(
    new THREE.SphereGeometry(1,32,32),
    new THREE.MeshBasicMaterial({ color: 0xff00ff, wireframe:true, opacity:0.3, transparent:true })
  );
  scene.add(wireMesh);

  function animate() {
    requestAnimationFrame(animate);
    headPoints.rotation.y += 0.002;
    wireMesh.rotation.y += 0.002;
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener('resize', ()=> {
    camera.aspect = canvas.clientWidth/canvas.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(canvas.clientWidth, canvas.clientHeight);
  });
</script>

<script>
  // === Mouth animation / Speech synthesis ===
  const mouth = document.getElementById("percy-mouth");
  let anim;
  async function speakPercy(text) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.rate = 1;
    utter.pitch = 1.1;
    utter.volume = 1;
    utter.voice = speechSynthesis.getVoices().find(v => v.name.includes("Google") || v.name.includes("Microsoft")) || null;
    utter.onstart = startMouthAnimation;
    utter.onend = stopMouthAnimation;
    speechSynthesis.speak(utter);
  }
  function startMouthAnimation() {
    if (mouth.dataset.active === "true") return;
    mouth.dataset.active = "true";
    function loop() {
      if (mouth.dataset.active !== "true") return;
      const newHeight = mouth.offsetHeight * (0.7 + Math.random() * 0.6);
      mouth.style.height = `${newHeight}px`;
      anim = requestAnimationFrame(loop);
    }
    loop();
  }
  function stopMouthAnimation() {
    mouth.dataset.active = "false";
    cancelAnimationFrame(anim);
    mouth.style.height = `${mouth.parentElement.offsetHeight * 0.08}px`;
  }
</script>

<!-- Keep all your console, UI, chat, camera feed, TensorFlow scripts, etc. -->

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7"></script>
<script src="js/percy.js?v=6.4"></script>
</body>
</html>
