<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>P.E.R.C.Y - AI</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; background:#111; color:white; overflow:hidden; }
  #logic-map { position:relative; width:100vw; height:100vh; background:#0a0a0f; overflow:hidden; }
  #logic-nodes { position:absolute; top:50%; left:50%; width:100%; height:100%; transform:translate(-50%,-50%) scale(1); }
  .console-line { margin:2px 0; font-family:ui-monospace,Monaco,Consolas, monospace; font-size:12px; }
  .console-line.ask { color:#d6d8ff; } /* normal Ask Percy */
  .console-line.exec { color:#7fff7f; } /* Part H Exec */
  #percy-console { position:fixed; bottom:0; left:0; width:35%; max-height:40%; overflow:auto; background:rgba(0,0,0,0.65); padding:6px; border-top-right-radius:12px; border:1px solid #444; }
  #percy-message { position:fixed; bottom:0; left:35%; width:65%; padding:6px; background:rgba(0,0,0,0.65); border-top-left-radius:12px; border:1px solid #444; }

  /* Visualizer (top-right, compact) */
  #voice-visualizer {
    position:fixed;
    top:12px;
    right:12px;
    width:360px;
    height:128px;
    pointer-events:none;
    z-index:9999;
    display:flex;
    align-items:center;
    border-radius:12px;
    background: linear-gradient(180deg, rgba(7,7,12,0.6), rgba(7,7,12,0.35));
    box-shadow: 0 6px 24px rgba(0,255,255,0.08), inset 0 1px 0 rgba(255,255,255,0.02);
    border:1px solid rgba(0,255,255,0.1);
  }
  #voice-canvas {
    flex:1;
    height:100%;
    width:100%;
    display:block;
    border-radius:8px;
    background: linear-gradient(180deg, rgba(0,0,0,0.1), rgba(0,0,0,0.05));
  }

  /* AskPercy button style */
  #askPercyButton, #percy-exec-run {
    padding:6px 12px;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
    z-index:9999;
  }
  #askPercyButton { position:fixed; top:12px; left:530px; background:#1a1aff; }
  #askPercyButton:hover { background:#3333ff; }
  #percy-exec-run { position:fixed; top:50px; left:530px; background:#1aff55; }
  #percy-exec-run:hover { background:#33ff77; }

  /* Inputs */
  #interpreter-input, #percy-exec-input, #seed-search {
    position:fixed; padding:6px; z-index:9999; width:300px;
  }
  #seed-search { top:12px; left:12px; width:200px; }
  #interpreter-input { top:12px; left:220px; }
  #percy-exec-input { top:50px; left:220px; width:300px; }
</style>
</head>
<body>
  <div id="logic-map"><div id="logic-nodes"></div></div>
  <div id="percy-console"></div>
  <div id="percy-message"></div>

  <input id="seed-search" placeholder="Search seeds">
  <input id="interpreter-input" placeholder="Ask Percy">
  <button id="askPercyButton">Run</button>

  <input id="percy-exec-input" placeholder="Percy Exec (Math/Java/Tools)">
  <button id="percy-exec-run">Run Exec</button>

  <!-- Percy core -->
  <script src="js/percy.js?v=6.4"></script>

  <!-- Voice Visualizer -->
  <div id="voice-visualizer" aria-hidden="true">
    <canvas id="voice-canvas"></canvas>
  </div>

<script>
/* === Ask Percy input with echo and response === */
(function(){
  const interpreterInput=document.getElementById('interpreter-input');
  const percyConsole=document.getElementById('percy-console');
  const askButton=document.getElementById('askPercyButton');

  function appendConsole(text,isUser=false,exec=false){
    const line=document.createElement('div');
    line.className='console-line '+(isUser?'ask':'') + (exec?' exec':'');
    line.textContent=(isUser? '↳ ' : '')+text;
    percyConsole.appendChild(line);
    percyConsole.scrollTop=percyConsole.scrollHeight;
  }

  function runPercyCommand(){
    const query=interpreterInput.value.trim();
    if(query){
      appendConsole(query,true); // user input
      let response="";
      if(typeof percyRespond==='function'){
        response=percyRespond(query);
      } else if(window.Percy && typeof Percy.interpret==='function'){
        response=Percy.interpret(query);
      }
      if(response){
        appendConsole(response,false,false);
        if(Percy && typeof Percy.speak==='function') Percy.speak(response);
      }
      interpreterInput.value='';
    }
  }

  if(interpreterInput) interpreterInput.addEventListener('keydown',e=>{ if(e.key==='Enter') runPercyCommand(); });
  if(askButton) askButton.addEventListener('click',runPercyCommand);
})();
</script>

<script>
/* === Part H Exec Input (Advanced Math/Java/Tools) === */
(function(){
  const execInput = document.getElementById('percy-exec-input');
  const execBtn = document.getElementById('percy-exec-run');
  const consoleDiv = document.getElementById('percy-console');

  if(!execInput) return;

  async function handleExecInput(){
    const query = execInput.value.trim();
    if(!query) return;
    execInput.value = "";

    // Append user input
    const userLine = document.createElement("div");
    userLine.className = "console-line ask";
    userLine.textContent = "↳ " + query;
    consoleDiv.appendChild(userLine);

    // Route through PartH
    let output = "";
    if(window.PercyState?.PartH?.routeInput){
      output = await PercyState.PartH.routeInput(query);
    } else {
      output = "⚠️ Percy Part H not loaded.";
    }

    // Append Percy output (green)
    const percyLine = document.createElement("div");
    percyLine.className = "console-line exec";
    percyLine.textContent = "🤖 " + output;
    consoleDiv.appendChild(percyLine);

    consoleDiv.scrollTop = consoleDiv.scrollHeight;

  }

  // ENTER key
  execInput.addEventListener("keydown", async e=>{
    if(e.key==="Enter"){ e.preventDefault(); await handleExecInput(); }
  });

  // RUN button
  if(execBtn) execBtn.addEventListener("click", handleExecInput);
})();
</script>

</body>
</html>
