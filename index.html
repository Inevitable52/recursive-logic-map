<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Percy Chat Interface</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#111; color:white; display:flex; flex-direction:column; height:100vh; }
  #chat-container { flex:1; overflow-y:auto; padding:10px; display:flex; flex-direction:column; gap:6px; }
  .message { padding:6px 10px; border-radius:8px; max-width:70%; word-wrap:break-word; }
  .user { align-self:flex-end; background:#3764ff; color:white; }
  .percy { align-self:flex-start; background:#27a0ff; color:white; }
  #input-container { display:flex; padding:10px; background:#0b0b12; }
  #user-input { flex:1; padding:8px; border-radius:8px; border:none; font-size:14px; }
  #send-btn { margin-left:6px; padding:8px 12px; border:none; border-radius:8px; background:#3764ff; color:white; cursor:pointer; }
</style>
</head>
<body>

<div id="chat-container"></div>

<div id="input-container">
  <input type="text" id="user-input" placeholder="Type your message here..." />
  <button id="send-btn">Send</button>
</div>

<script src="percy.js"></script> <!-- make sure this path is correct -->

<script>
const chatContainer = document.getElementById('chat-container');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');

// Function to append messages
function appendMessage(text, sender) {
  const msg = document.createElement('div');
  msg.className = 'message ' + sender;
  msg.textContent = text;
  chatContainer.appendChild(msg);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Function to simulate Percy responding
function percyReply(userText) {
  if (!PercyState) return;

  // Store user message as a seed
  PercyState.createSeed(userText, 'userMessage');

  // Generate autonomous thought (Percy-style response)
  PercyState.autonomousThought();

  // Pick the latest thought seed
  const keys = Object.keys(PercyState.gnodes);
  const latestId = keys[keys.length-1];
  const latestSeed = PercyState.gnodes[latestId];
  const reply = latestSeed?.message || "ðŸ¤– Percy is thinking...";

  appendMessage(reply, 'percy');
  if (Voice?.speak) Voice.speak(reply);
}

// Handle send
function sendMessage() {
  const text = userInput.value.trim();
  if (!text) return;
  appendMessage(text, 'user');
  userInput.value = '';
  percyReply(text);
}

// Events
sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keypress', e => { if(e.key==='Enter') sendMessage(); });

// Optional: welcome message
appendMessage("ðŸ¤– Percy online. Say something!", 'percy');
</script>

</body>
</html>
