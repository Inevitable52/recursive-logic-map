<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Percy AI Dashboard</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; background: #111; color: white; overflow: hidden; }
  #logic-map { position: absolute; top:0; left:0; width: 100vw; height: 70vh; background: #0a0a0f; overflow: hidden; }
  #logic-nodes { position: absolute; top: 50%; left: 50%; width: 100%; height: 100%; transform: translate(-50%,-50%) scale(1); }
  
  /* Chat box */
  #chat-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 30vh; background: #111; overflow-y: auto; padding: 8px; box-sizing: border-box; }
  #chat-container p { margin: 2px 0; font-family: monospace; font-size: 13px; color: #d6d8ff; }
  #input-container { position: absolute; bottom: 0; width: 100%; display: flex; }
  #user-input { flex: 1; padding: 8px; border: none; outline: none; font-size: 14px; }
  #send-btn { padding: 8px 12px; background: #3764ff; color: white; border: none; cursor: pointer; }
</style>
</head>
<body>

<div id="logic-map">
  <div id="logic-nodes"></div>
</div>

<div id="chat-container"></div>
<div id="input-container">
  <input type="text" id="user-input" placeholder="Ask Percy something..." />
  <button id="send-btn">Send</button>
</div>

<script src="./js/percy.js"></script>
<script>
const chatBox = document.getElementById('chat-container');
const input = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');

function addChatMessage(sender, msg) {
  const p = document.createElement('p');
  p.textContent = `${sender}: ${msg}`;
  chatBox.appendChild(p);
  chatBox.scrollTop = chatBox.scrollHeight;
}

sendBtn.addEventListener('click', () => {
  const msg = input.value.trim();
  if (!msg) return;
  addChatMessage('You', msg);
  input.value = '';
  
  // Pass message to Percy for response
  if (window.PercyState) {
    PercyState.createSeed(msg, "userInput");
    // Generate a "thought" response
    const keys = Object.keys(PercyState.gnodes);
    if(keys.length){
      const lastSeed = PercyState.gnodes[keys[keys.length-1]];
      const response = `ðŸ¤– Percy thinks: ${lastSeed.message.slice(0,100)}`; // first 100 chars
      addChatMessage('Percy', response);
      if (typeof Voice !== 'undefined') Voice.speak(response);
    }
  }
});

// Allow Enter key
input.addEventListener('keydown', e => { if(e.key === 'Enter') sendBtn.click(); });
</script>

</body>
</html>
