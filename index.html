<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Percy AI Dashboard</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; background:#111; color:white; overflow:hidden; }
  #logic-map { position:absolute; top:0; left:0; width:100vw; height:70vh; background:#0a0a0f; overflow:hidden; }
  #logic-nodes { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%) scale(1); width:100%; height:100%; }

  /* Chat box */
  #chat-container { position:absolute; bottom:0; left:0; width:100%; height:30vh; background:#111; overflow-y:auto; padding:8px; box-sizing:border-box; }
  #chat-container p { margin:2px 0; font-family: monospace; font-size:13px; color:#d6d8ff; }
  #input-container { position:absolute; bottom:0; width:100%; display:flex; }
  #user-input { flex:1; padding:8px; border:none; outline:none; font-size:14px; }
  #send-btn { padding:8px 12px; background:#3764ff; color:white; border:none; cursor:pointer; }

  /* Node neon colors (from percy.js) */
  .cyan-bubble{color:#00eaff;}
  .blue-bubble{color:#27a0ff;}
  .magenta-bubble{color:#ff4af0;}
  .red-bubble{color:#ff3b3b;}
  .orange-bubble{color:#ff9d2e;}
  .yellow-bubble{color:#ffe44a;}
  .pink-bubble{color:#ff6bd8;}
  .node{
    position:absolute; border-radius:50%; display:flex; align-items:center; justify-content:center;
    font-weight:700; color:#fff; cursor:pointer;
    background: radial-gradient(100% 100% at 30% 30%, rgba(255,255,255,0.10), rgba(0,0,0,0.10));
    border:2px solid currentColor;
    box-shadow: 0 0 6px currentColor, 0 0 14px currentColor, inset 0 0 12px rgba(255,255,255,0.08);
    text-shadow: 0 1px 2px rgba(0,0,0,0.6);
    user-select:none; transition: transform .15s ease, box-shadow .15s ease, filter .15s ease; backdrop-filter: blur(1px);
  }
  .node:hover { transform: scale(1.08); filter: brightness(1.15); }
  .node:active { transform: scale(0.98); }
</style>
</head>
<body>

<div id="logic-map">
  <div id="logic-nodes"></div>
</div>

<div id="chat-container"></div>
<div id="input-container">
  <input type="text" id="user-input" placeholder="Ask Percy something..." />
  <button id="send-btn">Send</button>
</div>

<script src="./js/percy.js"></script>
<script>
const chatBox = document.getElementById('chat-container');
const input = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');

// Add a message to chat box
function addChatMessage(sender, msg){
  const p = document.createElement('p');
  p.textContent = `${sender}: ${msg}`;
  chatBox.appendChild(p);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Hook Percy to show all messages automatically
if(typeof PercyState !== 'undefined'){
  const originalSpeak = PercyState.speak;

  PercyState.speak = function(msg){
    addChatMessage('ðŸ¤– Percy', msg);  // Show in chat
    if(typeof originalSpeak === 'function') originalSpeak.call(PercyState, msg); // Original voice
  }

  // Optional: automatically show autonomous thoughts if Percy has a queue
  setInterval(()=>{
    if(PercyState?.autonomousQueue?.length){
      const msg = PercyState.autonomousQueue.shift();
      PercyState.speak(msg);
    }
  }, 1000);
}

// Send message to Percy on click
sendBtn.addEventListener('click', ()=>{
  const msg = input.value.trim();
  if(!msg) return;
  addChatMessage('You', msg);
  input.value = '';

  if(window.PercyState){
    const id = PercyState.createSeed(msg,'userInput');
    const seed = PercyState.gnodes[id];
    const response = seed.message.slice(0,200);
    PercyState.speak(response);
  }
});

// Allow Enter key
input.addEventListener('keydown', e=>{
  if(e.key==='Enter') sendBtn.click();
});

// Auto-refresh nodes
setInterval(()=>{ if(typeof refreshNodes==='function') refreshNodes(); },5000);
</script>

</body>
</html>
