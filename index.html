<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Percy Recursive Logic Map ‚Äî TrueAI</title>

  <!-- Percy CSS -->
  <link rel="stylesheet" href="style.css?v=6.4" />
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#111; color:white; overflow:hidden; }
    main { position: relative; width: 100%; height: 100%; }

    /* Zoom Controls */
    .zoom-controls { position: fixed; top: 10px; right: 10px; z-index: 1000; display: flex; gap: 6px; }
    .zoom-controls button { padding: 4px 8px; border-radius:6px; border:none; background:#3764ff; color:white; cursor:pointer; }
    .zoom-controls button:hover { background:#2a4de0; }

    /* Search Input */
    #seed-search { position: fixed; top:10px; left:50%; transform:translateX(-50%); z-index:1000; padding:6px 10px; border-radius:8px; border:1px solid #555; width:220px; background:#1a1a1a; color:white; }
    #seed-search::placeholder { color:#bbb; }

    /* Ask Percy Input */
    #ask-input { padding:6px 8px; border-radius:6px; border:1px solid #555; width:220px; background:#1a1a1a; color:white; }
    #ask-btn { padding:6px 10px; border-radius:6px; border:none; background:#2ac66d; color:white; cursor:pointer; }
    #ask-btn:hover { background:#28b15f; }

    /* Console */
    #percy-console { position:fixed; bottom:70px; left:50%; transform:translateX(-50%); width:90%; max-width:800px; max-height:250px; overflow-y:auto; background:#1a1a1a; border:1px solid #555; border-radius:6px; padding:6px; font-size:14px; }
    .console-line { margin:2px 0; }
  </style>
</head>
<body>
  <header style="text-align:center; padding:10px;">
    <h1>Percy Recursive Logic Map ‚Äî TrueAI</h1>
    <p>Visualizing Logic Seeds G080‚ÄìG800</p>
  </header>

  <main>
    <input type="text" id="seed-search" placeholder="Search G-seed..." autocomplete="off"/>
    <div class="zoom-controls">
      <button onclick="zoomLevel*=1.2; applyTransform();">Zoom In</button>
      <button onclick="zoomLevel*=0.8; applyTransform();">Zoom Out</button>
    </div>
    <div id="logic-map">
      <svg width="100%" height="100%"></svg>
      <div id="logic-nodes"></div>
    </div>
    <div id="percy-message">Click a logic node to hear Percy‚Äôs thoughts...</div>
    <div id="percy-console">
      <p class="console-line">‚úÖ Percy TrueAI initialized.</p>
    </div>
  </main>

  <footer style="text-align:center;padding:8px;margin-top:10px;">
    <p>¬© 2025 Fabian V Omega ‚Äî Percy Recursive Logic System</p>
  </footer>

  <!-- Percy Core Script -->
  <script src="js/percy.js?v=6.4"></script>
  <script>
    // Make percyRespond callable globally
    window.Percy = { percyRespond };
  </script>

  <!-- Seed Search -->
  <script>
    const searchInput = document.getElementById('seed-search');
    searchInput.addEventListener('input', ()=> {
      const val = searchInput.value.trim().toUpperCase();
      document.querySelectorAll('.node').forEach(n=>{
        n.style.display = (!val || n.textContent.toUpperCase().includes(val)) ? 'flex' : 'none';
      });
    });
  </script>

  <!-- Ask Percy TrueAI -->
  <script>
    // UI Elements
    const askWrapper = document.createElement('div');
    askWrapper.id = 'percy-ask';
    askWrapper.style.cssText = `position:fixed; bottom:20px; left:50%; transform:translateX(-50%); z-index:1000; display:flex; gap:4px;`;
    askWrapper.innerHTML = `<input type="text" id="ask-input" placeholder="Ask Percy..." autocomplete="off" />
                            <button id="ask-btn">Ask</button>`;
    document.body.appendChild(askWrapper);

    const askInput = document.getElementById('ask-input');
    const askBtn = document.getElementById('ask-btn');
    const consoleEl = document.getElementById('percy-console');

    // Initialize memory and state
    if(!window.PercyState) window.PercyState = { gnodes: [], memory: [] };

    // TrueAI Ask function
    async function askPercy(message) {
      const userLine = document.createElement('p');
      userLine.className = 'console-line';
      userLine.textContent = `You: ${message}`;
      consoleEl.appendChild(userLine);

      const thinkingLine = document.createElement('p');
      thinkingLine.className = 'console-line';
      thinkingLine.textContent = `Percy: ü§î thinking‚Ä¶`;
      consoleEl.appendChild(thinkingLine);
      consoleEl.scrollTop = consoleEl.scrollHeight;

      let reply = '';
      try {
        // 1. Retrieve related seeds
        const relatedSeeds = PercyState.gnodes
          .filter(s => s.text && message.split(' ').some(w => s.text.includes(w)))
          .slice(0,5);

        thinkingLine.textContent = `Percy: üîç analyzing ${relatedSeeds.length} related logic seeds‚Ä¶`;
        consoleEl.scrollTop = consoleEl.scrollHeight;

        // 2. Chain-of-thought reasoning
        let reasoning = '';
        for(const seed of relatedSeeds){
          reasoning += `Considering "${seed.text}"...\n`;
          await new Promise(r=>setTimeout(r, 150));
        }

        // 3. Generate answer
        reply = relatedSeeds.length
          ? `Based on logic seeds, I deduce: "${relatedSeeds[0].text}"`
          : "I see no direct seeds, forming a general reasoning‚Ä¶";

        // 4. Optional meta-seed creation (TrueAI self-evolution)
        const newSeed = { id: `G${Date.now()}`, text: `Derived from interaction: "${message}"` };
        PercyState.gnodes.push(newSeed);

        // 5. Store interaction in memory
        PercyState.memory.push({question: message, answer: reply, reasoning, timestamp: Date.now()});
        if(typeof Memory !== 'undefined') Memory.save("interactions", PercyState.memory);

      } catch(e) {
        reply = `‚ùå Percy error: ${e.message}`;
        console.error(e);
      }

      thinkingLine.textContent = `Percy: ${reply}`;
      consoleEl.scrollTop = consoleEl.scrollHeight;

      if(typeof UI !== 'undefined' && UI.say) UI.say(reply);
    }

    // Event listeners
    askBtn.addEventListener('click', () => { if(askInput.value.trim()) { askPercy(askInput.value.trim()); askInput.value=''; } });
    askInput.addEventListener('keydown', e => { if(e.key==='Enter') askBtn.click(); });
  </script>

  <!-- Percy Self-Mod & Part C (Memory + Interactive) -->
  <script>
    (function PercyPartC(){
      if(!window.PercyState) return console.warn("‚ùå PercyState not loaded yet.");

      // Memory-based self-mod function
      PercyState.memoryRewrite = function(changeFn){
        try {
          changeFn(this); // Pass PercyState for modification
          if(typeof Memory !== 'undefined') Memory.save("gnodes", this.gnodes);
          if(typeof refreshNodes==='function') refreshNodes();
          if(typeof UI!=='undefined' && UI.say) UI.say("‚úÖ Percy memory-based self-mod applied");
        } catch(e){
          console.error("‚ùå Percy memoryRewrite error:", e);
          if(typeof UI!=='undefined' && UI.say) UI.say(`‚ùå Percy memoryRewrite error: ${e.message}`);
        }
      };

      // Example self-mod test
      PercyState.memoryRewrite(ps => {
        ps.gnodes.push({id:"TEST"+Date.now(), text:"üß© Test self-mod applied: Percy now can memory-mod itself!"});
      });

      // Optional interactive console command
      window.PercyMemoryMod = (codeStr)=>{
        try { PercyState.memoryRewrite(ps=>eval(codeStr)); }
        catch(e){ if(typeof UI!=='undefined' && UI.say) UI.say(`‚ùå Interactive memory mod error: ${e.message}`); }
      };

      if(typeof UI!=='undefined' && UI.say) UI.say("üß© Percy Part C (self-mod + interactive) loaded.");
    })();
  </script>
</body>
</html>
